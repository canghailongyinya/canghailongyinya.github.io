<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MIPS单周期CPU设计 | Strange-Hai~</title><meta name="author" content="Strange-Hai,longyuhai512@gmail.com"><meta name="copyright" content="Strange-Hai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言 本实验为中山大学zjy老师（）的计算机组成原理课程实验报告，实验要求设计一个类MIPS指令集的单周期CPU，并使用该CPU对输入的10个数进行冒泡排序。  一、实验目的    设计类MIPS指令集的单周期CPU。    加深对CPU各模块单元和数据通路的理解。    最终实现使用设计的CPU对输入的10个数进行冒泡排序。  二、实验内容    设计的类MIPS指令集：   6个R-type运">
<meta property="og:type" content="article">
<meta property="og:title" content="MIPS单周期CPU设计">
<meta property="og:url" content="http://canghailongyinya.github.io/2025/01/16/MIPS%E5%8D%95%E5%91%A8%E6%9C%9FCPU%E8%AE%BE%E8%AE%A1/index.html">
<meta property="og:site_name" content="Strange-Hai~">
<meta property="og:description" content="前言 本实验为中山大学zjy老师（）的计算机组成原理课程实验报告，实验要求设计一个类MIPS指令集的单周期CPU，并使用该CPU对输入的10个数进行冒泡排序。  一、实验目的    设计类MIPS指令集的单周期CPU。    加深对CPU各模块单元和数据通路的理解。    最终实现使用设计的CPU对输入的10个数进行冒泡排序。  二、实验内容    设计的类MIPS指令集：   6个R-type运">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://canghailongyinya.github.io/images/avatar2.jpeg">
<meta property="article:published_time" content="2025-01-15T17:26:44.000Z">
<meta property="article:modified_time" content="2025-01-16T12:33:17.585Z">
<meta property="article:author" content="Strange-Hai">
<meta property="article:tag" content="MIPS CPU">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://canghailongyinya.github.io/images/avatar2.jpeg"><link rel="shortcut icon" href="/images/avatar3.jpg"><link rel="canonical" href="http://canghailongyinya.github.io/2025/01/16/MIPS%E5%8D%95%E5%91%A8%E6%9C%9FCPU%E8%AE%BE%E8%AE%A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MIPS单周期CPU设计',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/images/bg1.jpeg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/avatar2.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/top_img3.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Strange-Hai~</span></a><a class="nav-page-title" href="/"><span class="site-name">MIPS单周期CPU设计</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MIPS单周期CPU设计</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-01-15T17:26:44.000Z" title="Created 2025-01-16 01:26:44">2025-01-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-16T12:33:17.585Z" title="Updated 2025-01-16 20:33:17">2025-01-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>18mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><ul>
<li>本实验为中山大学zjy老师（<img src="/post_images%5C0040FAC4.png" alt="alt text">）的计算机组成原理课程实验报告，实验要求设计一个类MIPS指令集的单周期CPU，并使用该CPU对输入的10个数进行冒泡排序。</li>
</ul>
<h3 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h3><ol>
<li>   设计类MIPS指令集的单周期CPU。</li>
<li>   加深对CPU各模块单元和数据通路的理解。</li>
<li>   最终实现使用设计的CPU对输入的10个数进行冒泡排序。</li>
</ol>
<h3 id="二、实验内容"><a href="#二、实验内容" class="headerlink" title="二、实验内容"></a>二、实验内容</h3><ol>
<li>   设计的类MIPS指令集：</li>
</ol>
<ul>
<li>6个R-type运算指令</li>
<li>3个I-type运算指令</li>
<li>2个I-type存取数指令：<ul>
<li>由于需要寻址的数据范围比较小，这里直接将lw和sw指令的立即数字段设置为0，通过rs寄存器的值存取特定的数据。</li>
</ul>
</li>
<li>2个I-type分支指令</li>
<li>1个J-type跳转指令</li>
<li>1个halt停机指令</li>
</ul>
<table>
<thead>
<tr>
<th>R型</th>
<th>opcode[31:26]</th>
<th>rs[25:21]</th>
<th>rt[20:16]</th>
<th>rd[15:11]</th>
<th>shamt[10:6]</th>
<th>funct[5:0]</th>
</tr>
</thead>
<tbody><tr>
<td>add</td>
<td>000000</td>
<td>rs</td>
<td>rt</td>
<td>rd</td>
<td>00000</td>
<td>100000</td>
</tr>
<tr>
<td>sub</td>
<td>000000</td>
<td>rs</td>
<td>rt</td>
<td>rd</td>
<td>00000</td>
<td>100010</td>
</tr>
<tr>
<td>and</td>
<td>000000</td>
<td>rs</td>
<td>rt</td>
<td>rd</td>
<td>00000</td>
<td>100100</td>
</tr>
<tr>
<td>or</td>
<td>000000</td>
<td>rs</td>
<td>rt</td>
<td>rd</td>
<td>00000</td>
<td>100101</td>
</tr>
<tr>
<td>slt</td>
<td>000000	rs</td>
<td>rt</td>
<td>rd</td>
<td>00000</td>
<td>101010</td>
<td></td>
</tr>
<tr>
<td>sll</td>
<td>000000</td>
<td>00000</td>
<td>rt</td>
<td>rd</td>
<td>shamt</td>
<td>000000</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>J型</th>
<th>opcode[31:26]</th>
<th>addr[25:0]</th>
</tr>
</thead>
<tbody><tr>
<td>j</td>
<td>000010</td>
<td>addr</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>待机指令</th>
<th>inst</th>
</tr>
</thead>
<tbody><tr>
<td>halt</td>
<td>111111 11111 11111 11111 11111 111111</td>
</tr>
</tbody></table>
<ol start="2">
<li>   控制单元输出的14个（10+4）个控制信号：</li>
</ol>
<ul>
<li>Reg_Dst：为1时目标寄存器为rd，否则为rt</li>
<li>ALU_Src1：为1时ALU的第一个输入为rs寄存器的值，第二个输入为shamt</li>
<li>ALU_Src2：为1时ALU的第二个输入为立即数，否则为rt</li>
<li>Mem_Write：为1时需要写回数据存储器</li>
<li>Mem_Read：为1时需要读取数据存储器</li>
<li>MemtoReg：为1时写回数据存储器的值来自寄存器</li>
<li>Reg_Write：为1时需要写回寄存器</li>
<li>Branch：为1时表明指令是分支指令，和ALU的result想与决定是否分支</li>
<li>Jump：为1时跳转到目标地址</li>
<li>Halt：为1时表明指令为停机指令</li>
<li>ALUCtrl（4位）：</li>
</ul>
<table>
<thead>
<tr>
<th>ALUCtrl</th>
<th>operate</th>
<th>inst</th>
<th>opcode</th>
<th>funct</th>
</tr>
</thead>
<tbody><tr>
<td>0000</td>
<td>&amp;</td>
<td>and</td>
<td>000000</td>
<td>100100</td>
</tr>
<tr>
<td>0000</td>
<td>&amp;</td>
<td>andi</td>
<td>001100</td>
<td>NULL</td>
</tr>
<tr>
<td>0001</td>
<td>&#124;</td>
<td>or</td>
<td>000000</td>
<td>100101</td>
</tr>
<tr>
<td>0001</td>
<td>&#124;</td>
<td>ori</td>
<td>001101</td>
<td>100101</td>
</tr>
<tr>
<td>0010</td>
<td>+</td>
<td>add</td>
<td>000000</td>
<td>100000</td>
</tr>
<tr>
<td>0010</td>
<td>+</td>
<td>addi</td>
<td>001000</td>
<td>NULL</td>
</tr>
<tr>
<td>0010</td>
<td>+</td>
<td>lw</td>
<td>100011</td>
<td>NULL</td>
</tr>
<tr>
<td>0010</td>
<td>+</td>
<td>sw</td>
<td>101011</td>
<td>NULL</td>
</tr>
<tr>
<td>0010</td>
<td>+</td>
<td>j</td>
<td>000010</td>
<td>NULL</td>
</tr>
<tr>
<td>0110</td>
<td>-</td>
<td>sub</td>
<td>000000</td>
<td>100010</td>
</tr>
<tr>
<td>0110</td>
<td>-</td>
<td>beq</td>
<td>000100</td>
<td>NULL</td>
</tr>
<tr>
<td>0110</td>
<td>-</td>
<td>bne</td>
<td>000101</td>
<td>NULL</td>
</tr>
<tr>
<td>0111</td>
<td>&lt;</td>
<td>slt</td>
<td>000000</td>
<td>101010</td>
</tr>
<tr>
<td>1100</td>
<td>&lt;&lt;</td>
<td>sll</td>
<td>000000</td>
<td>000000</td>
</tr>
<tr>
<td>1111</td>
<td>stop</td>
<td>halt</td>
<td>111111</td>
<td>111111</td>
</tr>
</tbody></table>
<ol start="3">
<li>   冒泡程序代码：</li>
</ol>
<ul>
<li>C语言代码如下：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="built_in">array</span>[] = &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">0</span>&#125;</span><br><span class="line"><span class="type">int</span> i, j; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">9</span> - i - <span class="number">1</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">array</span>[j] &lt; <span class="built_in">array</span>[j + <span class="number">1</span>]) &#123;	</span><br><span class="line">            <span class="type">int</span> temp = <span class="built_in">array</span>[j]; </span><br><span class="line">            <span class="built_in">array</span>[j] = <span class="built_in">array</span>[j +<span class="number">1</span>]; </span><br><span class="line">            <span class="built_in">array</span>[j +<span class="number">1</span>] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<ul>
<li>编译为MIPS汇编如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">    array:  .word 3,4,9,7,8,5,1,2,6,0</span><br><span class="line">    newline: .asciiz &quot;\n&quot; </span><br><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">	addi $1,$0,9</span><br><span class="line">	add $2,$0,$0</span><br><span class="line">	loop1:</span><br><span class="line">	add $4,$0,$0</span><br><span class="line">	</span><br><span class="line">	loop2:</span><br><span class="line">	lw $6,0($4)</span><br><span class="line">	addi $7,$4,1</span><br><span class="line">	lw $8,0($7)</span><br><span class="line">	slt $9,$6,$8</span><br><span class="line">	bne $9,$0,noswap</span><br><span class="line">	sw $6,0($7)</span><br><span class="line">	sw $8,0($4)</span><br><span class="line">	noswap:</span><br><span class="line">	</span><br><span class="line">	addi $4,$4,1</span><br><span class="line">	slt $5,$4,$1</span><br><span class="line">	bne $5,$0,loop2</span><br><span class="line">	</span><br><span class="line">	addi $2,$2,1</span><br><span class="line">	slt $3,$2,$1</span><br><span class="line">	bne $3,$0,loop1</span><br></pre></td></tr></table></figure>
<ul>
<li>生成的十六进制码如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffffffff 20010009 00001020 00002020 8c860000 20870001 8ce80000 00c8482a 1520000b ace60000 ac880000 20840001 0081282a 14a00004 20420001 0041182a 14600003</span><br></pre></td></tr></table></figure>

<h3 id="三、实验过程"><a href="#三、实验过程" class="headerlink" title="三、实验过程"></a>三、实验过程</h3><ol>
<li>   环境准备（vscode+git）：</li>
</ol>
<ul>
<li>工欲善其事，必先利其器。做小实验的时候属实是被vivado默认编辑器回退和制表恶心到了，于是毅然决然的（网上学的）将默认编辑器改为最爱的vscode，使得在vivado编写代码时直接跳转到vscode；此外，为了更好的可视化修改的地方以及避免把代码改炸了改不回来的问题，本人推荐使用vscode的git插件来进行版本控制以记录进度和避免不可逆的错误。界面如下：<br><img src="/post_images/image.png" alt="alt text"></li>
</ul>
<ol start="2">
<li>   CPU各模块代码展示和简要说明</li>
</ol>
<ul>
<li>顶层文件top：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top(</span><br><span class="line">    <span class="keyword">input</span> Clk,</span><br><span class="line">    <span class="keyword">input</span> Clr,</span><br><span class="line">    <span class="keyword">input</span> btn_in, </span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] Mem_write_data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] display_led3,</span><br><span class="line">    <span class="keyword">output</span> over, <span class="comment">//输入阶段结束标志</span></span><br><span class="line">    <span class="keyword">output</span> sortover, <span class="comment">//排序阶段结束标志</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">6</span>:<span class="number">0</span>] sm_duan,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] sm_wei</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] display_led;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] PC;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] inst;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] AluCtrl;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Read_Reg_Addr1;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Read_Reg_Addr2;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] Write_Reg_Addr;</span><br><span class="line">    <span class="keyword">wire</span> Reg_Dst;</span><br><span class="line">    <span class="keyword">wire</span> ALU_Src1;</span><br><span class="line">    <span class="keyword">wire</span> ALU_Src2;</span><br><span class="line">    <span class="keyword">wire</span> Mem_Write;</span><br><span class="line">    <span class="keyword">wire</span> Mem_Read;</span><br><span class="line">    <span class="keyword">wire</span> MemtoReg;</span><br><span class="line">    <span class="keyword">wire</span> Reg_Write;</span><br><span class="line">    <span class="keyword">wire</span> Branch;</span><br><span class="line">    <span class="keyword">wire</span> Jump;</span><br><span class="line">    <span class="keyword">wire</span> Halt;</span><br><span class="line">    <span class="keyword">wire</span> write_enable_btn;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] Mem_read_data; <span class="comment">//数据存储器读出的数据</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] display_data; <span class="comment">//显示的数据</span></span><br><span class="line">    <span class="keyword">wire</span> clk_div;</span><br><span class="line">    CLK_div Clk_div (</span><br><span class="line">        <span class="variable">.CLK_in</span>(Clk),</span><br><span class="line">        <span class="variable">.CLK_out</span>(clk_div)</span><br><span class="line">    );</span><br><span class="line">    debounce db (</span><br><span class="line">        <span class="variable">.Clk</span>(Clk),</span><br><span class="line">        <span class="variable">.btn_in</span>(btn_in),</span><br><span class="line">        <span class="variable">.btn_out</span>(write_enable_btn)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//输入数据</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_read_addr3;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] Mem_write_data3;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_write_addr;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_read_addr;</span><br><span class="line">    DataMem dataMem (</span><br><span class="line">        <span class="variable">.clk</span>(Clk),</span><br><span class="line">        <span class="variable">.clr</span>(Clr),</span><br><span class="line">        <span class="variable">.write_enable_btn</span>(write_enable_btn),</span><br><span class="line">        <span class="comment">//.write_enable_btn(btn_in),</span></span><br><span class="line">        <span class="variable">.Mem_Write</span>(Mem_Write),</span><br><span class="line">        <span class="variable">.Mem_write_data</span>(Mem_write_data3),</span><br><span class="line">        <span class="variable">.Mem_write_addr</span>(Mem_write_addr),</span><br><span class="line">        <span class="variable">.Mem_read_addr</span>(Mem_read_addr3),</span><br><span class="line">        <span class="variable">.Mem_read_data</span>(Mem_read_data),</span><br><span class="line">        <span class="variable">.display_led</span>(display_led),</span><br><span class="line">        <span class="variable">.over</span>(over)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">assign</span> display_data = over ? Mem_read_data : Mem_write_data;</span><br><span class="line">    <span class="comment">//显示数据</span></span><br><span class="line">    display display (</span><br><span class="line">        <span class="variable">.clk</span>(Clk),          <span class="comment">// input wire clk</span></span><br><span class="line">        <span class="variable">.data</span>(display_data),        <span class="comment">// input wire [15 : 0] data</span></span><br><span class="line">        <span class="variable">.sm_wei</span>(sm_wei),    <span class="comment">// output wire [3 : 0] sm_wei</span></span><br><span class="line">        <span class="variable">.sm_duan</span>(sm_duan)  <span class="comment">// output wire [6 : 0] sm_duan</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] result; <span class="comment">//ALU计算</span></span><br><span class="line">    <span class="comment">//读取指令</span></span><br><span class="line">    PC pc (</span><br><span class="line">        <span class="variable">.Clk</span>(Clk),</span><br><span class="line">        <span class="variable">.Clr</span>(Clr),</span><br><span class="line">        <span class="variable">.Branch</span>(Branch),</span><br><span class="line">        <span class="variable">.Jump</span>(Jump),</span><br><span class="line">        <span class="variable">.inst</span>(inst),</span><br><span class="line">        <span class="variable">.PC</span>(PC),</span><br><span class="line">        <span class="variable">.result</span>(result),</span><br><span class="line">        <span class="variable">.over</span>(over),</span><br><span class="line">        <span class="variable">.sortover</span>(sortover)</span><br><span class="line">    );</span><br><span class="line">    InstMem instMem (</span><br><span class="line">        <span class="variable">.addra</span>(PC),</span><br><span class="line">        <span class="variable">.douta</span>(inst)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//控制单元</span></span><br><span class="line">    AluCtrl aluCtrl (</span><br><span class="line">        <span class="variable">.inst</span>(inst),</span><br><span class="line">        <span class="variable">.AluCtrl</span>(AluCtrl),</span><br><span class="line">        <span class="variable">.Reg_Dst</span>(Reg_Dst),</span><br><span class="line">        <span class="variable">.ALU_Src1</span>(ALU_Src1),</span><br><span class="line">        <span class="variable">.ALU_Src2</span>(ALU_Src2),</span><br><span class="line">        <span class="variable">.Mem_Write</span>(Mem_Write),</span><br><span class="line">        <span class="variable">.Mem_Read</span>(Mem_Read),</span><br><span class="line">        <span class="variable">.MemtoReg</span>(MemtoReg),</span><br><span class="line">        <span class="variable">.Reg_Write</span>(Reg_Write),</span><br><span class="line">        <span class="variable">.Branch</span>(Branch),</span><br><span class="line">        <span class="variable">.Jump</span>(Jump),</span><br><span class="line">        <span class="variable">.Halt</span>(Halt)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//写入和读取寄存器的数据</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] Write_Reg_Data;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] Read_Reg_Data1;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] Read_Reg_Data2;</span><br><span class="line">    <span class="keyword">assign</span> Read_Reg_Addr1 = inst[<span class="number">25</span>:<span class="number">21</span>];</span><br><span class="line">    <span class="keyword">assign</span> Read_Reg_Addr2 = inst[<span class="number">20</span>:<span class="number">16</span>];</span><br><span class="line">    RegFile regFile (</span><br><span class="line">        <span class="variable">.Clk</span>(Clk),</span><br><span class="line">        <span class="variable">.Clr</span>(Clr),</span><br><span class="line">        <span class="variable">.Reg_Write</span>(Reg_Write),</span><br><span class="line">        <span class="variable">.Read_Reg_Addr1</span>(Read_Reg_Addr1),</span><br><span class="line">        <span class="variable">.Read_Reg_Addr2</span>(Read_Reg_Addr2),</span><br><span class="line">        <span class="variable">.Write_Reg_Addr</span>(Write_Reg_Addr),</span><br><span class="line">        <span class="variable">.Write_Reg_Data</span>(Write_Reg_Data),</span><br><span class="line">        <span class="variable">.Read_Reg_Data1</span>(Read_Reg_Data1),</span><br><span class="line">        <span class="variable">.Read_Reg_Data2</span>(Read_Reg_Data2)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] input1;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] input2;</span><br><span class="line">    <span class="comment">// 决定ALU的输入</span></span><br><span class="line">    <span class="keyword">always</span> @* <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (Mem_Read == <span class="number">1</span> || Mem_Write == <span class="number">1</span>) <span class="keyword">begin</span> <span class="comment">//lw、sw指令//lw、sw的立即数直接设置为0（lw $rt,0($rs)）即result为0-9</span></span><br><span class="line">            input1 = Read_Reg_Data1;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_Src1 == <span class="number">1</span>) <span class="keyword">begin</span> <span class="comment">//sll指令</span></span><br><span class="line">            input1 = Read_Reg_Data2;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            input1 = Read_Reg_Data1;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span> (Mem_Read == <span class="number">1</span> || Mem_Write == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            input2 = <span class="number">32&#x27;b0</span>; <span class="comment">//lw、sw的立即数直接设置为0-9（lw $rt,0(0-9)）input1为0，即result为0-9</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">if</span> (ALU_Src2 == <span class="number">1</span>) <span class="keyword">begin</span> <span class="comment">//ALU_Src2为1，则第二个输入为立即数</span></span><br><span class="line">            input2 = &#123;&#123;<span class="number">16</span>&#123;inst[<span class="number">15</span>]&#125;&#125;, inst[<span class="number">15</span>:<span class="number">0</span>]&#125;;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_Src1 == <span class="number">1</span>) <span class="keyword">begin</span> <span class="comment">//sll指令</span></span><br><span class="line">            input2 = inst[<span class="number">15</span>:<span class="number">11</span>];  <span class="comment">//shamt</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            input2 = Read_Reg_Data2;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">wire</span> zero;</span><br><span class="line">    <span class="comment">//wire [31:0] result; //ALU计算</span></span><br><span class="line">    ALU alu (</span><br><span class="line">        <span class="variable">.input1</span>(input1),</span><br><span class="line">        <span class="variable">.input2</span>(input2),</span><br><span class="line">        <span class="variable">.AluCtrl</span>(AluCtrl),</span><br><span class="line">        <span class="variable">.result</span>(result),</span><br><span class="line">        <span class="variable">.zero</span>(zero)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] Mem_write_data2;</span><br><span class="line">    <span class="comment">//lw、sw的立即数直接设置为0（lw $rt,0($rs)）即result为0-9</span></span><br><span class="line">    <span class="keyword">always</span> @* <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">//读取和写入内存(Mem阶段)</span></span><br><span class="line">        <span class="keyword">if</span> (Mem_Read == <span class="number">1</span> || Mem_Write == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            Mem_write_addr = result; <span class="comment">//Mem_Write为1直接写入数据存储器</span></span><br><span class="line">            Mem_read_addr = result; <span class="comment">//数据流直接读取数据到Mem_read_data</span></span><br><span class="line">            Mem_write_data2 = Read_Reg_Data2; <span class="comment">//Mem_Write为1直接写入数据存储器</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">//写回(WriteBack阶段)</span></span><br><span class="line">        <span class="keyword">if</span> (Reg_Dst == <span class="number">1</span>) <span class="keyword">begin</span> <span class="comment">//R型指令</span></span><br><span class="line">            Write_Reg_Addr = inst[<span class="number">15</span>:<span class="number">11</span>]; <span class="comment">//R型指令的rd</span></span><br><span class="line">            Write_Reg_Data = result;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            Write_Reg_Addr = inst[<span class="number">20</span>:<span class="number">16</span>]; <span class="comment">//lw、sw指令的rt</span></span><br><span class="line">            <span class="comment">// Write_Reg_Data = result;</span></span><br><span class="line">            <span class="keyword">if</span> (MemtoReg == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                Write_Reg_Data = Mem_read_data;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                Write_Reg_Data = result;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span>      </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// 读取内存的数据</span></span><br><span class="line">    <span class="keyword">integer</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] display_led2;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] Mem_read_addr2;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk_div <span class="keyword">or</span> <span class="keyword">posedge</span> Clr) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (Clr == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            display_led2 = <span class="number">10&#x27;b1000000000</span>;</span><br><span class="line">            i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (sortover == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">10</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span> (i)</span><br><span class="line">                    <span class="number">0</span>: display_led2 = <span class="number">10&#x27;b1000000000</span>;</span><br><span class="line">                    <span class="number">1</span>: display_led2 = <span class="number">10&#x27;b0100000000</span>;</span><br><span class="line">                    <span class="number">2</span>: display_led2 = <span class="number">10&#x27;b0010000000</span>;</span><br><span class="line">                    <span class="number">3</span>: display_led2 = <span class="number">10&#x27;b0001000000</span>;</span><br><span class="line">                    <span class="number">4</span>: display_led2 = <span class="number">10&#x27;b0000100000</span>;</span><br><span class="line">                    <span class="number">5</span>: display_led2 = <span class="number">10&#x27;b0000010000</span>;</span><br><span class="line">                    <span class="number">6</span>: display_led2 = <span class="number">10&#x27;b0000001000</span>;</span><br><span class="line">                    <span class="number">7</span>: display_led2 = <span class="number">10&#x27;b0000000100</span>;</span><br><span class="line">                    <span class="number">8</span>: display_led2 = <span class="number">10&#x27;b0000000010</span>;</span><br><span class="line">                    <span class="number">9</span>: display_led2 = <span class="number">10&#x27;b0000000001</span>;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">                Mem_read_addr2 = i;</span><br><span class="line">                i = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @* <span class="keyword">begin</span></span><br><span class="line">        display_led3 = sortover ? display_led2 : display_led;</span><br><span class="line">        Mem_read_addr3 = sortover ? Mem_read_addr2 : Mem_read_addr;</span><br><span class="line">        Mem_write_data3 = over ? Mem_write_data2 : Mem_write_data;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>时钟分频Clk_div和抖动消除debounce模块：<ul>
<li>使用计数器实现对时钟的分频以显示数据：</li>
</ul>
</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> CLK_div #(<span class="keyword">parameter</span> N = <span class="number">50000000</span>)(</span><br><span class="line">    <span class="keyword">input</span> CLK_in,</span><br><span class="line">    <span class="keyword">output</span> CLK_out</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>]counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">reg</span> out = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> CLK_in) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (counter==N-<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            counter &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            counter &lt;= counter + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> CLK_in) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (counter == N-<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            out &lt;= !out;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> CLK_out = out;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>消除按键在按下或松开时由于机械接触不良等原因导致的抖动信号：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> debounce (</span><br><span class="line">    <span class="keyword">input</span> Clk,</span><br><span class="line">    <span class="keyword">input</span> btn_in,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> btn_out </span><br><span class="line">);</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>] count; </span><br><span class="line">    <span class="keyword">reg</span> btn_in_d; </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> Clk) <span class="keyword">begin</span></span><br><span class="line">        btn_in_d &lt;= btn_in; </span><br><span class="line">        <span class="keyword">if</span> (btn_in == btn_in_d) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">20&#x27;hFFFFF</span>) <span class="keyword">begin</span></span><br><span class="line">                btn_out &lt;= btn_in; </span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                count &lt;= count + <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            count &lt;= <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>数据存储器DataMem模块：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> DataMem(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> clr,</span><br><span class="line">    <span class="keyword">input</span> write_enable_btn,</span><br><span class="line">    <span class="keyword">input</span> Mem_Write,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] Mem_write_data,    <span class="comment">//输入</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_read_addr,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_write_addr,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] Mem_read_data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] display_led,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> over</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] data [<span class="number">9</span>:<span class="number">0</span>];     <span class="comment">//10个16位数</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_write_addr2;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        Mem_write_addr2 = <span class="number">0</span>;</span><br><span class="line">        display_led = <span class="number">10&#x27;b1000000000</span>;</span><br><span class="line">        over = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] Mem_write_addr3;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> write_enable_btn <span class="keyword">or</span> <span class="keyword">posedge</span> clr) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (clr == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            Mem_write_addr2 = <span class="number">0</span>;</span><br><span class="line">            display_led = <span class="number">10&#x27;b1000000000</span>;</span><br><span class="line">            over = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (over == <span class="number">0</span> &amp;&amp; Mem_write_addr2 &lt; <span class="number">10</span>) <span class="keyword">begin</span>    <span class="comment">//over为0时依次输入10个数</span></span><br><span class="line">            Mem_write_addr2 = Mem_write_addr2 + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">case</span> (Mem_write_addr2)</span><br><span class="line">                <span class="number">4&#x27;b0001</span>: display_led &lt;= <span class="number">10&#x27;b0100000000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0010</span>: display_led &lt;= <span class="number">10&#x27;b0010000000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0011</span>: display_led &lt;= <span class="number">10&#x27;b0001000000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0100</span>: display_led &lt;= <span class="number">10&#x27;b0000100000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0101</span>: display_led &lt;= <span class="number">10&#x27;b0000010000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0110</span>: display_led &lt;= <span class="number">10&#x27;b0000001000</span>;</span><br><span class="line">                <span class="number">4&#x27;b0111</span>: display_led &lt;= <span class="number">10&#x27;b0000000100</span>;</span><br><span class="line">                <span class="number">4&#x27;b1000</span>: display_led &lt;= <span class="number">10&#x27;b0000000010</span>;</span><br><span class="line">                <span class="number">4&#x27;b1001</span>: display_led &lt;= <span class="number">10&#x27;b0000000001</span>;</span><br><span class="line">                <span class="keyword">default</span>: display_led &lt;= <span class="number">10&#x27;b1000000000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">if</span> (Mem_write_addr2 == <span class="number">10</span> ) <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">//write_enable &lt;= 0;</span></span><br><span class="line">                display_led &lt;= <span class="number">10&#x27;b1000000000</span>;</span><br><span class="line">                over &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        Mem_write_addr3 = over ? Mem_write_addr : Mem_write_addr2;</span><br><span class="line">        <span class="keyword">if</span> (over == <span class="number">0</span> || Mem_Write == <span class="number">1</span>) <span class="keyword">begin</span>    <span class="comment">//over为0或Mem_Write为1时允许输入数据</span></span><br><span class="line">            data[Mem_write_addr3] &lt;= Mem_write_data;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> Mem_read_data = data[Mem_read_addr];</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>数码管显示display模块：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> display(clk, data, sm_wei, sm_duan);</span><br><span class="line">    <span class="keyword">input</span> clk;</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] data; </span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] sm_wei; </span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>] sm_duan;</span><br><span class="line">    <span class="keyword">integer</span> clk_cnt;        </span><br><span class="line">    <span class="keyword">reg</span> clk_500Hz;         </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (clk_cnt == <span class="number">32&#x27;d99999</span>) <span class="keyword">begin</span></span><br><span class="line">            clk_cnt &lt;= <span class="number">1&#x27;b0</span>;       </span><br><span class="line">            clk_500Hz &lt;= ~clk_500Hz;  </span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            clk_cnt &lt;= clk_cnt + <span class="number">1&#x27;b1</span>; </span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] wei_ctrl = <span class="number">4&#x27;b1110</span>; </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk_500Hz) <span class="keyword">begin</span></span><br><span class="line">        wei_ctrl &lt;= &#123;wei_ctrl[<span class="number">2</span>:<span class="number">0</span>], wei_ctrl[<span class="number">3</span>]&#125;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] duan_ctrl;</span><br><span class="line">    <span class="keyword">always</span> @(wei_ctrl) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (wei_ctrl)</span><br><span class="line">            <span class="number">4&#x27;b1110</span>: duan_ctrl = data[<span class="number">3</span>:<span class="number">0</span>]; </span><br><span class="line">            <span class="number">4&#x27;b1101</span>: duan_ctrl = data[<span class="number">7</span>:<span class="number">4</span>];   </span><br><span class="line">            <span class="number">4&#x27;b1011</span>: duan_ctrl = data[<span class="number">11</span>:<span class="number">8</span>];  </span><br><span class="line">            <span class="number">4&#x27;b0111</span>: duan_ctrl = data[<span class="number">15</span>:<span class="number">12</span>]; </span><br><span class="line">            <span class="keyword">default</span>: duan_ctrl = <span class="number">4&#x27;hf</span>;    </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] duan;</span><br><span class="line">    <span class="keyword">always</span> @(duan_ctrl)</span><br><span class="line">        <span class="keyword">case</span>(duan_ctrl)</span><br><span class="line">            <span class="number">4&#x27;h0</span>: duan = <span class="number">7&#x27;b100_0000</span>; </span><br><span class="line">            <span class="number">4&#x27;h1</span>: duan = <span class="number">7&#x27;b111_1001</span>; </span><br><span class="line">            <span class="number">4&#x27;h2</span>: duan = <span class="number">7&#x27;b010_0100</span>; </span><br><span class="line">            <span class="number">4&#x27;h3</span>: duan = <span class="number">7&#x27;b011_0000</span>; </span><br><span class="line">            <span class="number">4&#x27;h4</span>: duan = <span class="number">7&#x27;b001_1001</span>; </span><br><span class="line">            <span class="number">4&#x27;h5</span>: duan = <span class="number">7&#x27;b001_0010</span>; </span><br><span class="line">            <span class="number">4&#x27;h6</span>: duan = <span class="number">7&#x27;b000_0010</span>; </span><br><span class="line">            <span class="number">4&#x27;h7</span>: duan = <span class="number">7&#x27;b111_1000</span>; </span><br><span class="line">            <span class="number">4&#x27;h8</span>: duan = <span class="number">7&#x27;b000_0000</span>; </span><br><span class="line">            <span class="number">4&#x27;h9</span>: duan = <span class="number">7&#x27;b001_0000</span>; </span><br><span class="line">            <span class="number">4&#x27;ha</span>: duan = <span class="number">7&#x27;b000_1000</span>; </span><br><span class="line">            <span class="number">4&#x27;hb</span>: duan = <span class="number">7&#x27;b000_0011</span>; </span><br><span class="line">            <span class="number">4&#x27;hc</span>: duan = <span class="number">7&#x27;b100_0110</span>; </span><br><span class="line">            <span class="number">4&#x27;hd</span>: duan = <span class="number">7&#x27;b010_0001</span>; </span><br><span class="line">            <span class="number">4&#x27;he</span>: duan = <span class="number">7&#x27;b000_0110</span>; </span><br><span class="line">            <span class="number">4&#x27;hf</span>: duan = <span class="number">7&#x27;b000_1110</span>; </span><br><span class="line">            <span class="keyword">default</span>: duan = <span class="number">7&#x27;b100_0000</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">assign</span> sm_wei = wei_ctrl;</span><br><span class="line">    <span class="keyword">assign</span> sm_duan = duan;  </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>程序计数器PC模块</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PC(</span><br><span class="line">    <span class="keyword">input</span> Clk,</span><br><span class="line">    <span class="keyword">input</span> Clr,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] inst,</span><br><span class="line">    <span class="keyword">input</span> Branch,</span><br><span class="line">    <span class="keyword">input</span> Jump,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] result,</span><br><span class="line">    <span class="keyword">input</span> over,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] PC,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> sortover</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        sortover = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">        <span class="comment">//读取指令</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> Clk <span class="keyword">or</span> <span class="keyword">posedge</span> Clr) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (Clr) <span class="keyword">begin</span></span><br><span class="line">            PC = <span class="number">8&#x27;b0</span>;</span><br><span class="line">            sortover = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (over == <span class="number">1</span> &amp;&amp; sortover == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">//排序过程中···</span></span><br><span class="line">            <span class="keyword">if</span> (PC == <span class="number">8&#x27;b00010001</span>) <span class="keyword">begin</span> </span><br><span class="line">                PC = <span class="number">8&#x27;b0</span>;<span class="comment">//////////</span></span><br><span class="line">                sortover = <span class="number">1</span>;           </span><br><span class="line">            <span class="keyword">end</span> </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (Branch == <span class="number">1</span> &amp;&amp; (inst[<span class="number">26</span>] ^ result == <span class="number">0</span>)) <span class="keyword">begin</span></span><br><span class="line">                PC = inst[<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (Jump == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                PC = inst[<span class="number">25</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> PC = PC + <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            PC = <span class="number">8&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>指令存储器InstMem模块：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> InstMem(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] addra,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] douta</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] instmem [<span class="number">63</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        instmem[<span class="number">0</span>] = <span class="number">32&#x27;hffffffff</span>;</span><br><span class="line">        instmem[<span class="number">1</span>] = <span class="number">32&#x27;h20010009</span>;</span><br><span class="line">        instmem[<span class="number">2</span>] = <span class="number">32&#x27;h00001020</span>;</span><br><span class="line">        instmem[<span class="number">3</span>] = <span class="number">32&#x27;h00002020</span>;</span><br><span class="line">        instmem[<span class="number">4</span>] = <span class="number">32&#x27;h8c860000</span>;</span><br><span class="line">        instmem[<span class="number">5</span>] = <span class="number">32&#x27;h20870001</span>;</span><br><span class="line">        instmem[<span class="number">6</span>] = <span class="number">32&#x27;h8ce80000</span>;</span><br><span class="line">        instmem[<span class="number">7</span>] = <span class="number">32&#x27;h00c8482a</span>;</span><br><span class="line">        instmem[<span class="number">8</span>] = <span class="number">32&#x27;h1520000b</span>;</span><br><span class="line">        instmem[<span class="number">9</span>] = <span class="number">32&#x27;hace60000</span>;</span><br><span class="line">        instmem[<span class="number">10</span>] = <span class="number">32&#x27;hac880000</span>;</span><br><span class="line">        instmem[<span class="number">11</span>] = <span class="number">32&#x27;h20840001</span>;</span><br><span class="line">        instmem[<span class="number">12</span>] = <span class="number">32&#x27;h0081282a</span>;</span><br><span class="line">        instmem[<span class="number">13</span>] = <span class="number">32&#x27;h14a00004</span>;</span><br><span class="line">        instmem[<span class="number">14</span>] = <span class="number">32&#x27;h20420001</span>;</span><br><span class="line">        instmem[<span class="number">15</span>] = <span class="number">32&#x27;h0041182a</span>;</span><br><span class="line">        instmem[<span class="number">16</span>] = <span class="number">32&#x27;h14600003</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> douta = instmem[addra];</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line">g)	ALU控制单元AluCtrl模块：</span><br><span class="line"><span class="keyword">module</span> AluCtrl(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] inst,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] AluCtrl,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Reg_Dst,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> ALU_Src1,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> ALU_Src2,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Mem_Write,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Mem_Read,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> MemtoReg,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Reg_Write,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Branch,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Jump,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> Halt</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">26</span>] opcode;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">5</span>:<span class="number">0</span>] funct;</span><br><span class="line">    <span class="keyword">assign</span> opcode = inst[<span class="number">31</span>:<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">assign</span> funct = inst[<span class="number">5</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (opcode)</span><br><span class="line">            <span class="number">6&#x27;b000000</span>: <span class="keyword">begin</span> <span class="comment">// r-type</span></span><br><span class="line">                Reg_Dst = <span class="number">1</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">0</span>; </span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>; <span class="comment">//直接从ALU写回寄存器</span></span><br><span class="line">                Reg_Write = <span class="number">1</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">case</span> (funct)</span><br><span class="line">                    <span class="number">6&#x27;b100000</span>: <span class="keyword">begin</span></span><br><span class="line">                        AluCtrl = <span class="number">4&#x27;b0010</span>; <span class="comment">// add</span></span><br><span class="line">                        ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">6&#x27;b100010</span>: <span class="keyword">begin</span></span><br><span class="line">                        AluCtrl = <span class="number">4&#x27;b0110</span>; <span class="comment">// sub</span></span><br><span class="line">                        ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">6&#x27;b100100</span>: <span class="keyword">begin</span>    </span><br><span class="line">                        AluCtrl = <span class="number">4&#x27;b0000</span>; <span class="comment">// and</span></span><br><span class="line">                        ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">6&#x27;b100101</span>: <span class="keyword">begin</span></span><br><span class="line">                        AluCtrl = <span class="number">4&#x27;b0001</span>; <span class="comment">// or</span></span><br><span class="line">                        ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">6&#x27;b101010</span>: <span class="keyword">begin</span></span><br><span class="line">                        AluCtrl = <span class="number">4&#x27;b0111</span>; <span class="comment">// slt</span></span><br><span class="line">                        ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">6&#x27;b000000</span>: <span class="keyword">begin</span></span><br><span class="line">                        AluCtrl = <span class="number">4&#x27;b1100</span>; <span class="comment">// sll                       </span></span><br><span class="line">                        ALU_Src1 = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b001000</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0010</span>; <span class="comment">// addi</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//写回寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">1</span>; <span class="comment">//第二个源操作数为立即数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">1</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b001100</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0000</span>; <span class="comment">// andi</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//写回寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">1</span>; <span class="comment">//第二个源操作数为立即数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">1</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b001101</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0001</span>; <span class="comment">// ori</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//写回寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">1</span>; <span class="comment">//第二个源操作数为立即数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">1</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b100011</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0010</span>; <span class="comment">// lw</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//目标寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">1</span>; <span class="comment">//第二个源操作数为立即数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">1</span>;</span><br><span class="line">                MemtoReg = <span class="number">1</span>;</span><br><span class="line">                Reg_Write = <span class="number">1</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b101011</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0010</span>; <span class="comment">// sw</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//目标寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">1</span>; <span class="comment">//第二个源操作数为立即数</span></span><br><span class="line">                Mem_Write = <span class="number">1</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">0</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b000100</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0110</span>; <span class="comment">// beq</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//无关</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">0</span>; <span class="comment">//第二个源操作数为寄存器数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">0</span>;</span><br><span class="line">                Branch = <span class="number">1</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b000101</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0110</span>; <span class="comment">// bne</span></span><br><span class="line">                <span class="comment">//Reg_Dst无关</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//目标寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">0</span>; <span class="comment">//第二个源操作数为寄存器数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">0</span>;</span><br><span class="line">                Branch = <span class="number">1</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b000010</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b0010</span>; <span class="comment">// j</span></span><br><span class="line">                <span class="comment">//ALU_Src2无关</span></span><br><span class="line">                <span class="comment">//Reg_Dst无关</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//无关</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">0</span>; <span class="comment">//无关</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">0</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">6&#x27;b111111</span>: <span class="keyword">begin</span></span><br><span class="line">                AluCtrl = <span class="number">4&#x27;b1111</span>; <span class="comment">// halt</span></span><br><span class="line">                <span class="comment">//ALU_Src2无关</span></span><br><span class="line">                <span class="comment">//Reg_Dst无关</span></span><br><span class="line">                Reg_Dst = <span class="number">0</span>; <span class="comment">//目标寄存器地址为rt</span></span><br><span class="line">                ALU_Src1 = <span class="number">0</span>;</span><br><span class="line">                ALU_Src2 = <span class="number">0</span>; <span class="comment">//第二个源操作数为寄存器数</span></span><br><span class="line">                Mem_Write = <span class="number">0</span>;</span><br><span class="line">                Mem_Read = <span class="number">0</span>;</span><br><span class="line">                MemtoReg = <span class="number">0</span>;</span><br><span class="line">                Reg_Write = <span class="number">0</span>;</span><br><span class="line">                Branch = <span class="number">0</span>;</span><br><span class="line">                Jump = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>寄存器堆RegFile模块：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> RegFile(</span><br><span class="line">    <span class="keyword">input</span> Clk,</span><br><span class="line">    <span class="keyword">input</span> Clr,</span><br><span class="line">    <span class="keyword">input</span> Reg_Write,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Read_Reg_Addr1,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Read_Reg_Addr2,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Write_Reg_Addr,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] Write_Reg_Data,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] Read_Reg_Data1,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] Read_Reg_Data2</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] Regs [<span class="number">31</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">initial</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i = i + <span class="number">1</span>)</span><br><span class="line">            Regs[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> Clk <span class="keyword">or</span> <span class="keyword">posedge</span> Clr)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        Regs[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (Clr) </span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i = i + <span class="number">1</span>)</span><br><span class="line">                Regs[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">if</span> (Reg_Write) </span><br><span class="line">                Regs[Write_Reg_Addr] = Write_Reg_Data;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> Read_Reg_Data1 = Regs[Read_Reg_Addr1];</span><br><span class="line">    <span class="keyword">assign</span> Read_Reg_Data2 = Regs[Read_Reg_Addr2];</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ALU算术单元ALU模块：</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] input1,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] input2,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] AluCtrl,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] result,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> zero</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">always</span> @(*) </span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (AluCtrl)</span><br><span class="line">            <span class="number">4&#x27;b0000</span>: result = input1 &amp; input2;</span><br><span class="line">            <span class="number">4&#x27;b0001</span>: result = input1 | input2;</span><br><span class="line">            <span class="number">4&#x27;b0010</span>: result = input1 + input2;</span><br><span class="line">            <span class="number">4&#x27;b0110</span>: result = input1 - input2;</span><br><span class="line">            <span class="number">4&#x27;b0111</span>: result = input1 &lt; input2;</span><br><span class="line">            <span class="number">4&#x27;b1100</span>: result = input1 &lt;&lt; input2;</span><br><span class="line">            <span class="keyword">default</span>: result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>) zero = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> zero = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="四、实验结果"><a href="#四、实验结果" class="headerlink" title="四、实验结果"></a>四、实验结果</h3><ul>
<li>仿真波形图如下：<br><img src="/post_images/image2.png" alt="alt text"><br><img src="/post_images/image3.png" alt="alt text"></li>
<li>开发板显示如下：<br><img src="/post_images/image4.png" alt="alt text"><br><img src="/post_images/image5.png" alt="alt text"></li>
</ul>
<h3 id="五、实验总结"><a href="#五、实验总结" class="headerlink" title="五、实验总结"></a>五、实验总结</h3><ul>
<li>本次实验花费了一个周末的时间，具体大概20个小时吧。由于出题人“巧妙”的设计（从开发板手动输入10个数），为了避免实现前无古人的syscall指令，我使用了两套逻辑并以sort标志位来控制运行，其一是数据的手动输入到数据存储器，而后才是冒泡排序指令的执行。</li>
<li>实验过程中遇到了许多困难，但办法总比困难多。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://canghailongyinya.github.io">Strange-Hai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://canghailongyinya.github.io/2025/01/16/MIPS%E5%8D%95%E5%91%A8%E6%9C%9FCPU%E8%AE%BE%E8%AE%A1/">http://canghailongyinya.github.io/2025/01/16/MIPS%E5%8D%95%E5%91%A8%E6%9C%9FCPU%E8%AE%BE%E8%AE%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MIPS-CPU/">MIPS CPU</a></div><div class="post-share"><div class="social-share" data-image="/images/avatar2.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/01/07/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment </div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar2.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Strange-Hai</div><div class="author-info-description">A sample blog</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/canghailongyinya" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:longyuhai512@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a><a class="social-icon" href="https://www.zhihu.com/people/jiang-shan-zi-long" target="_blank" title="知乎"><i class="fab fa-zhihu" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="toc-number">2.</span> <span class="toc-text">一、实验目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9"><span class="toc-number">3.</span> <span class="toc-text">二、实验内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">三、实验过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">5.</span> <span class="toc-text">四、实验结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">五、实验总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/16/MIPS%E5%8D%95%E5%91%A8%E6%9C%9FCPU%E8%AE%BE%E8%AE%A1/" title="MIPS单周期CPU设计">MIPS单周期CPU设计</a><time datetime="2025-01-15T17:26:44.000Z" title="Created 2025-01-16 01:26:44">2025-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/01/07/hello-world/" title="Hello World">Hello World</a><time datetime="2025-01-07T11:54:11.684Z" title="Created 2025-01-07 19:54:11">2025-01-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/top_img3.jpeg);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Strange-Hai</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'canghailongyinya/giscus-comments',
      'data-repo-id': 'R_kgDONqxQnQ',
      'data-category-id': 'DIC_kwDONqxQnc4CmCEO',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !true) {
    if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>